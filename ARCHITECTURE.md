# IISFrontGuard Module - Package Architecture

## Package Structure

```
IISFrontGuard.Module.1.0.0.nupkg
?
??? IISFrontGuard.Module.nuspec          # Package manifest
??? README.md                             # Package documentation
?
??? lib/
?   ??? net48/
?       ??? IISFrontGuard.Module.dll     # Main assembly
?       ??? IISFrontGuard.Module.pdb     # Debug symbols
?       ??? IISFrontGuard.Module.xml     # XML documentation (optional)
?
??? content/
?   ??? GeoLite2-Country.mmdb            # GeoIP database
?   ??? UpdateGeoDb.bat                  # Database update script
?   ??? Scripts/
?   ?   ??? init.sql                     # SQL initialization
?   ??? web.config.transform             # Auto-configuration
?
??? [Content_Types].xml                  # Package metadata
```

## Installation Flow

```
????????????????????????????????????????????????????????????
?                    Developer Action                       ?
?                                                           ?
?   Install-Package IISFrontGuard.Module                   ?
????????????????????????????????????????????????????????????
                    ?
                    ?
????????????????????????????????????????????????????????????
?                NuGet Package Manager                      ?
????????????????????????????????????????????????????????????
                    ?
         ???????????????????????????????????????????????
         ?          ?          ?          ?            ?
         ?          ?          ?          ?            ?
    ?????????? ?????????? ?????????? ?????????? ????????????
    ?Download? ?Extract ? ?Install ? ?Transform? ? Update  ?
    ?Package ? ? Files  ? ?  Deps  ? ?Web.Config? ?References?
    ?????????? ?????????? ?????????? ?????????? ????????????
         ?          ?          ?          ?            ?
         ???????????????????????????????????????????????
                              ?
                              ?
????????????????????????????????????????????????????????????
?                     Project Files                         ?
?                                                           ?
?  YourProject/                                            ?
?  ??? bin/                                                ?
?  ?   ??? IISFrontGuard.Module.dll         ?            ?
?  ?   ??? IISFrontGuard.Module.pdb         ?            ?
?  ?   ??? GeoLite2-Country.mmdb            ?            ?
?  ?   ??? UpdateGeoDb.bat                  ?            ?
?  ?   ??? [All dependencies...]            ?            ?
?  ?                                                       ?
?  ??? Content/                                           ?
?  ?   ??? Scripts/                                       ?
?  ?       ??? init.sql                     ?            ?
?  ?                                                       ?
?  ??? packages.config                      ?? Updated    ?
?  ??? Web.config                           ?? Transformed?
?  ??? YourProject.csproj                   ?? Updated    ?
????????????????????????????????????????????????????????????
```

## Build & Publish Pipeline

```
???????????????????????????????????????????????????????????????
?                    Developer Commits Code                    ?
?                    (Push to master/main)                     ?
???????????????????????????????????????????????????????????????
                       ?
                       ?
???????????????????????????????????????????????????????????????
?               Azure DevOps Pipeline Triggered                ?
???????????????????????????????????????????????????????????????
                       ?
        ???????????????????????????????????????????????
        ?              ?              ?               ?
        ?              ?              ?               ?
   ??????????    ???????????   ????????????   ?????????????
   ? NuGet  ?    ?  Build  ?   ?   Run    ?   ? SonarCloud?
   ?Restore ? ????Solution ?????  Tests   ?????   Scan    ?
   ??????????    ???????????   ????????????   ?????????????
                                                      ?
                                                      ?
                                              ?????????????????
                                              ?  WhiteSource  ?
                                              ?     Scan      ?
                                              ?????????????????
                                                      ?
                       ????????????????????????????????
                       ?
                       ?
        ????????????????????????????????
        ?   Update NuSpec Version      ?
        ?????????????????????????????????
                       ?
                       ?
        ????????????????????????????????
        ?   NuGet Pack Command         ?
        ?   Creates .nupkg file        ?
        ?????????????????????????????????
                       ?
                       ?
        ????????????????????????????????
        ?   Publish Artifacts          ?
        ?????????????????????????????????
                       ?
           ?????????????????????????
           ?                       ?
           ?                       ?
????????????????????    ????????????????????
? Azure Artifacts  ?    ?   NuGet.org     ?
?  (Internal Feed) ?    ?   (Optional)    ?
????????????????????    ????????????????????
```

## Dependency Graph

```
IISFrontGuard.Module
??? IPNetwork (1.3.2.0)
??? MaxMind.Db (4.3.4)
?   ??? System.Buffers
?   ??? System.Memory
?   ??? System.Runtime.CompilerServices.Unsafe
??? MaxMind.GeoIP2 (5.4.1)
?   ??? MaxMind.Db
?   ??? Microsoft.Extensions.Options
?   ??? System.Text.Json
??? Microsoft.Bcl.AsyncInterfaces (10.0.1)
?   ??? System.Threading.Tasks.Extensions
??? Microsoft.Extensions.DependencyInjection.Abstractions (10.0.1)
?   ??? Microsoft.Bcl.AsyncInterfaces
??? Microsoft.Extensions.Options (10.0.1)
?   ??? Microsoft.Extensions.DependencyInjection.Abstractions
?   ??? Microsoft.Extensions.Primitives
??? Microsoft.Extensions.Primitives (10.0.1)
?   ??? System.Memory
?   ??? System.Runtime.CompilerServices.Unsafe
??? System.Buffers (4.6.1)
??? System.IO.Pipelines (10.0.1)
?   ??? System.Buffers
?   ??? System.Memory
?   ??? System.Threading.Tasks.Extensions
??? System.Memory (4.6.3)
?   ??? System.Buffers
?   ??? System.Numerics.Vectors
?   ??? System.Runtime.CompilerServices.Unsafe
??? System.Numerics.Vectors (4.6.1)
??? System.Runtime.CompilerServices.Unsafe (6.1.2)
??? System.Text.Encodings.Web (10.0.1)
?   ??? System.Buffers
?   ??? System.Memory
??? System.Text.Json (10.0.1)
?   ??? System.Buffers
?   ??? System.Memory
?   ??? System.Runtime.CompilerServices.Unsafe
?   ??? System.Text.Encodings.Web
?   ??? System.Threading.Tasks.Extensions
??? System.Threading.Tasks.Extensions (4.6.3)
?   ??? System.Runtime.CompilerServices.Unsafe
??? System.ValueTuple (4.6.1)
```

## Runtime Architecture

```
???????????????????????????????????????????????????????????????
?                      IIS Web Server                          ?
???????????????????????????????????????????????????????????????
                     ?
                     ?
???????????????????????????????????????????????????????????????
?                 IIS Request Pipeline                         ?
?                                                              ?
?  BeginRequest ??? AuthenticateRequest ??? AuthorizeRequest ?
?       ?                                                      ?
?       ????????????????????                                  ?
???????????????????????????????????????????????????????????????
                         ?
                         ?
???????????????????????????????????????????????????????????????
?              FrontGuardModule (IHttpModule)                  ?
?                                                              ?
?  ??????????????????????????????????????????????????????    ?
?  ? 1. Extract Request Data (IP, Path, Headers, etc.)  ?    ?
?  ??????????????????????????????????????????????????????    ?
?                         ?                                   ?
?                         ?                                   ?
?  ??????????????????????????????????????????????????????    ?
?  ? 2. GeoIP Lookup (Country Detection)                ?    ?
?  ?    ??? GeoIPService ??? GeoLite2-Country.mmdb     ?    ?
?  ??????????????????????????????????????????????????????    ?
?                         ?                                   ?
?                         ?                                   ?
?  ??????????????????????????????????????????????????????    ?
?  ? 3. Rate Limit Check                                 ?    ?
?  ?    ??? HttpRuntimeCacheProvider                    ?    ?
?  ??????????????????????????????????????????????????????    ?
?                         ?                                   ?
?                         ?                                   ?
?  ??????????????????????????????????????????????????????    ?
?  ? 4. WAF Rules Evaluation                            ?    ?
?  ?    ??? WafRuleRepository ??? SQL Database         ?    ?
?  ??????????????????????????????????????????????????????    ?
?                         ?                                   ?
?                         ?                                   ?
?  ??????????????????????????????????????????????????????    ?
?  ? 5. Decision: Allow / Block / Challenge / RateLimit ?    ?
?  ??????????????????????????????????????????????????????    ?
?                         ?                                   ?
?                         ?                                   ?
?  ??????????????????????????????????????????????????????    ?
?  ? 6. Log Security Event                              ?    ?
?  ?    ??? RequestLogger ??? SQL Database             ?    ?
?  ??????????????????????????????????????????????????????    ?
?                         ?                                   ?
?                         ?                                   ?
?  ??????????????????????????????????????????????????????    ?
?  ? 7. Webhook Notification (if configured)            ?    ?
?  ?    ??? WebhookNotifier ??? External API           ?    ?
?  ??????????????????????????????????????????????????????    ?
?                         ?                                   ?
?                         ?                                   ?
?  ??????????????????????????????????????????????????????    ?
?  ? 8. Execute Action:                                  ?    ?
?  ?    - Allow: Continue to application                ?    ?
?  ?    - Block: Return 403 Forbidden                   ?    ?
?  ?    - Challenge: Return interactive challenge       ?    ?
?  ?    - RateLimit: Return 429 Too Many Requests       ?    ?
?  ??????????????????????????????????????????????????????    ?
???????????????????????????????????????????????????????????????
                         ?
                         ?
???????????????????????????????????????????????????????????????
?        ASP.NET Application (if request allowed)              ?
???????????????????????????????????????????????????????????????
```

## Data Flow

```
External Request
      ?
      ?
????????????????
? Client IP    ????
? User Agent   ?  ?
? Request Path ?  ?
? Headers      ?  ?
? QueryString  ?  ?
????????????????  ?
                  ?
                  ?
         ???????????????????
         ? FrontGuardModule ?
         ????????????????????
                  ?
        ????????????????????????????????
        ?         ?         ?          ?
        ?         ?         ?          ?
   ?????????? ???????? ?????????? ???????????
   ? Cache  ? ?GeoIP ? ?  WAF   ? ? Logger  ?
   ?Provider? ?Service? ? Rules  ? ?         ?
   ?????????? ???????? ?????????? ???????????
                            ?           ?
                            ?           ?
                     ????????????????????????
                     ?   SQL Database       ?
                     ?                      ?
                     ? ???????????????????? ?
                     ? ? WafRules         ? ?
                     ? ? WafConditions    ? ?
                     ? ? SecurityEvents   ? ?
                     ? ? RequestLogs      ? ?
                     ? ? ChallengeHistory ? ?
                     ? ???????????????????? ?
                     ????????????????????????
```

## Package Lifecycle

```
Development ??? Build ??? Test ??? Package ??? Publish ??? Install ??? Use
    ?              ?        ?         ?          ?           ?          ?
    ?              ?        ?         ?          ?           ?          ?
    ?              ?        ?         ?          ?           ?          ?
Code Changes   Compile  Unit Tests  .nupkg   Feed Upload  NuGet PM  Production
                         Integration Created   Azure       Download
                         SonarCloud            Artifacts
                         WhiteSource           NuGet.org
```

---

**Architecture Version**: 1.0  
**Last Updated**: January 2025  
**Target Framework**: .NET Framework 4.8
